{% extends "tracker/base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>ðŸ“» Radios</h2>

    <!-- Section d'actualisation par lot -->
    <div class="container mt-4">
        <h2>Actualisation de la base Radio Browser</h2>
        <p>Nombre de radios actuellement en base : {{ radios_count }}</p>
        <button id="refresh-btn" class="btn btn-primary">Actualiser la base</button>

        <!-- Pays courant -->
        <div id="current-country" class="mt-2 mb-2 font-weight-bold"></div>

        <!-- Barre de progression -->
        <div class="progress mt-1" style="height: 25px; display: none;">
            <div id="refresh-progress" class="progress-bar progress-bar-striped progress-bar-animated"
                 role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                0%
            </div>
        </div>

        <!-- Message final -->
        <div id="refresh-messages" class="mt-2"></div>
    </div>

    <!-- Formulaire de recherche multi-sÃ©lection avec live search -->
    <form method="get" class="row g-3 mb-4 mt-4">
        <div class="col-md-4">
            <label for="country" class="form-label">Pays</label>
            <select id="country" name="country" class="selectpicker" multiple data-live-search="true" title="SÃ©lectionner pays">
                {% for c in countries %}
                <option value="{{ c }}" {% if c in selected_countries %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label for="state" class="form-label">RÃ©gion</label>
            <select id="state" name="state" class="selectpicker" multiple data-live-search="true" title="SÃ©lectionner rÃ©gion">
                {% for s in states %}
                <option value="{{ s }}" {% if s in selected_states %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label for="tag" class="form-label">Style</label>
            <select id="tag" name="tag" class="selectpicker" multiple data-live-search="true" title="SÃ©lectionner style">
                {% for t in tags %}
                <option value="{{ t }}" {% if t in selected_tags %}selected{% endif %}>{{ t }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-12 mt-2">
            <button type="submit" class="btn btn-primary">Rechercher</button>
        </div>
    </form>

    <!-- Table des rÃ©sultats -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Nom</th>
                    <th>Pays</th>
                    <th>RÃ©gion</th>
                    <th>Style</th>
                    <th>Site Web</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody>
                {% for r in radios %}
                <tr>
                    <td>{{ r.name }}</td>
                    <td>{{ r.country }}</td>
                    <td>{{ r.state }}</td>
                    <td>{{ r.tags }}</td>
                    <td>
                        {% if r.homepage %}
                        <a href="{{ r.homepage }}" target="_blank">{{ r.homepage }}</a>
                        {% endif %}
                    </td>
                    <td>{{ r.emails }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">Aucune radio trouvÃ©e.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Boutons d'export -->
    <div class="mt-3">
        <a href="{% url 'export_xlsx' %}" class="btn btn-success me-2">ðŸ“¥ Export XLSX</a>
        <a href="{% url 'export_pdf' %}" class="btn btn-info">ðŸ“¥ Export PDF</a>
    </div>
</div>
{% endblock %}
