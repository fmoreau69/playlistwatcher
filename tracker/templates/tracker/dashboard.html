{% extends "tracker/base.html" %}
{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
      <a id="btn-scan" href="{% url 'scan_playlists' %}" class="btn btn-warning">🔄 Scanner les playlists</a>
      <a id="btn-stop" href="{% url 'stop_scan_playlists' %}" class="btn btn-danger">⏹️ Arrêter le scan</a>
      <span id="scan-status"></span>
    </div>
    <h2>Apparitions ({{ active_playlists }} playlists actives)</h2>

    {% if new_playlists_count %}
    <div class="alert alert-success">
        {{new_playlists_count}} nouvelles playlists détectées !
    </div>
    {% endif %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Titre</th><th>Playlist</th><th>Curateur</th><th>Contact</th>
                    <th>Abonnés</th><th>Date d'ajout</th><th>État</th><th>Description</th><th>Mise à jour</th>
                </tr>
            </thead>
            <tbody>
                {% for a in rows %}
                <tr>
                <td>{{ a.track.name }}</td>
                <td>
                    {% if a.playlist.url %}
                        <a href="{{ a.playlist.url }}" target="_blank">{{ a.playlist.name }}</a>
                    {% else %}
                        {{ a.playlist.name }}
                    {% endif %}
                </td>
                <td>{% if a.playlist.owner_url %}<a href="{{ a.playlist.owner_url }}" target="_blank">{{ a.playlist.owner_name }}</a>{% else %}{{ a.playlist.owner_name }}{% endif %}</td>
                <td>{{ a.contact }}</td>
                <td>{{ a.playlist.followers|default_if_none:"" }}</td>
                <td>{{ a.added_on }}</td>
                <td>{{ a.state }}</td>
                <td>{{ a.playlist.description|truncatechars:80 }}</td>
                <td>{{ a.updated_on }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p><em>Astuce :</em> Lancement d’un scan via la commande <code>python manage.py scan_playlists</code>.</p>
    {% load static %}
    <script src="{% static 'tracker/js/dashboard.js' %}"></script>
{% endblock %}
